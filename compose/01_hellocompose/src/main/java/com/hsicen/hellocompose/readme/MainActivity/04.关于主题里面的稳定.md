
@Stable
class WeComposeColors(
    bottomBar: Color,
    background: Color,
    listItem: Color,
    divider: Color,
    chatPage: Color,
    textPrimary: Color,
    textPrimaryMe: Color,
    textSecondary: Color,
    onBackground: Color,
    icon: Color,
    iconCurrent: Color,
    badge: Color,
    onBadge: Color,
    bubbleMe: Color,
    bubbleOthers: Color,
    textFieldBackground: Color,
    more: Color,
    chatPageBgAlpha: Float,
) {
    var bottomBar: Color by mutableStateOf(bottomBar)
        private set
    var background: Color by mutableStateOf(background)
        private set
    var listItem: Color by mutableStateOf(listItem)
        private set
    var chatListDivider: Color by mutableStateOf(divider)
        private set
    var chatPage: Color by mutableStateOf(chatPage)
        private set
    var textPrimary: Color by mutableStateOf(textPrimary)
        private set
    var textPrimaryMe: Color by mutableStateOf(textPrimaryMe)
        private set
    var textSecondary: Color by mutableStateOf(textSecondary)
        private set
    var onBackground: Color by mutableStateOf(onBackground)
        private set
    var icon: Color by mutableStateOf(icon)
        private set
    var iconCurrent: Color by mutableStateOf(iconCurrent)
        private set
    var badge: Color by mutableStateOf(badge)
        private set
    var onBadge: Color by mutableStateOf(onBadge)
        private set
    var bubbleMe: Color by mutableStateOf(bubbleMe)
        private set
    var bubbleOthers: Color by mutableStateOf(bubbleOthers)
        private set
    var textFieldBackground: Color by mutableStateOf(textFieldBackground)
        private set
    var more: Color by mutableStateOf(more)
        private set
    var chatPageBgAlpha: Float by mutableStateOf(chatPageBgAlpha)
        private set
}

---------------------------------------------------------------------------------------------------

å½“ç„¶å¯ä»¥ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†åˆ†æä¸€ä¸‹è¿™ä¸ªè®¾è®¡ã€‚

ä½ çš„æ„Ÿè§‰å¾ˆæ•é”ï¼Œç›´æ¥ç”¨ `val` ç¡®å®æ˜¯æ›´ç®€å•çš„å†™æ³•ã€‚ä½†è¿™é‡Œé€‰æ‹© `var ... by mutableStateOf` ä¸»è¦æ˜¯ä¸ºäº†å®ç°ä¸€ä¸ªæ ¸å¿ƒç›®æ ‡ï¼š**è®©ä¸»é¢˜é¢œè‰²çš„åˆ‡æ¢å¸¦æœ‰å¹³æ»‘çš„åŠ¨ç”»æ•ˆæœï¼Œå¹¶ä¸”è®© Compose æ¡†æ¶èƒ½é«˜æ•ˆåœ°æ„ŸçŸ¥å’Œå“åº”è¿™äº›å˜åŒ–ã€‚**

æˆ‘ä»¬æ¥æ‹†è§£ä¸€ä¸‹è¿™èƒŒåçš„é€»è¾‘ã€‚

-----

### \#\# æ ¸å¿ƒåŸå› ï¼šä¸ºäº†åŠ¨ç”»å’Œé«˜æ•ˆçš„é‡ç»„ (Animation & Recomposition)

ç®€å•æ¥è¯´ï¼Œå¦‚æœ `WeComposeColors` é‡Œçš„æ‰€æœ‰å±æ€§éƒ½æ˜¯ `val`ï¼Œé‚£ä¹ˆå½“ä½ åˆ‡æ¢ä¸»é¢˜æ—¶ï¼ˆæ¯”å¦‚ä»äº®è‰²åˆ°æš—è‰²ï¼‰ï¼ŒUI ä¸Šçš„æ‰€æœ‰é¢œè‰²éƒ½ä¼š**ç¬é—´**æ”¹å˜ï¼Œä¼šæ˜¾å¾—éå¸¸ç”Ÿç¡¬ã€‚

è€Œå½“å‰çš„ä»£ç è®¾è®¡ï¼Œç»“åˆ `WeComposeTheme` å¯ç»„åˆå‡½æ•°ï¼Œå®ç°äº†ä¸€ä¸ªéå¸¸ä¼˜é›…çš„è¿‡æ¸¡åŠ¨ç”»ã€‚

-----

### \#\# å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥çœ‹å½“ä¸»é¢˜åˆ‡æ¢æ—¶ï¼Œä»£ç æ˜¯å¦‚ä½•è¿ä½œçš„ï¼š

1.  **è§¦å‘é‡ç»„**: å½“ `WeComposeTheme` çš„ `theme` å‚æ•°ä» `Light` å˜ä¸º `Dark` æ—¶ï¼Œ`WeComposeTheme` å‡½æ•°ä¼šå‘ç”Ÿ**é‡ç»„ (Recomposition)**ã€‚

2.  **è®¾å®šæ–°ç›®æ ‡**: `targetColors` ä¼šä» `LightColorPalette` åˆ‡æ¢åˆ° `DarkColorPalette`ã€‚

3.  **å¯åŠ¨åŠ¨ç”»**: æ‰€æœ‰çš„ `animateColorAsState` å‡½æ•°ä¼šæ¥æ”¶åˆ°æ–°çš„ç›®æ ‡é¢œè‰²ã€‚ä¾‹å¦‚ï¼Œ`animateColorAsState(targetColors.background, ...)` ä¼šå¼€å§‹ä¸€ä¸ªä»å½“å‰èƒŒæ™¯è‰²ï¼ˆäº®çš„ï¼‰åˆ°ç›®æ ‡èƒŒæ™¯è‰²ï¼ˆæš—çš„ï¼‰çš„åŠ¨ç”»ï¼ŒæŒç»­æ—¶é—´ä¸º 600 æ¯«ç§’ã€‚

4.  **åŠ¨ç”»è¿‡ç¨‹ä¸­çš„çŠ¶æ€æ›´æ–°**: åœ¨è¿™ 600 æ¯«ç§’å†…ï¼Œ`animateColorAsState` è¿”å›å€¼çš„ `.value` (ä¾‹å¦‚ `background.value`) ä¼šåœ¨**æ¯ä¸€å¸§**éƒ½æ›´æ–°ä¸ºä¸€ä¸ªä»‹äºèµ·å§‹è‰²å’Œç›®æ ‡è‰²ä¹‹é—´çš„ä¸­é—´é¢œè‰²ã€‚

5.  **åˆ›å»ºæ–°çš„ `WeComposeColors` å®ä¾‹**: åœ¨åŠ¨ç”»çš„æ¯ä¸€å¸§ï¼Œ`WeComposeTheme` éƒ½ä¼šè¢«é‡ç»„ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª**æ–°çš„** `colors` å¯¹è±¡ã€‚è¿™ä¸ªæ–°å¯¹è±¡çš„æ„é€ å‡½æ•°æ¥æ”¶çš„æ­£æ˜¯åŠ¨ç”»åœ¨å½“å‰å¸§çš„ä¸­é—´è‰²å€¼ï¼ˆ`background.value`, `listItem.value` ç­‰ï¼‰ã€‚

    ```kotlin
    // è¿™æ®µä»£ç åœ¨åŠ¨ç”»çš„æ¯ä¸€å¸§éƒ½ä¼šæ‰§è¡Œ
    val colors = WeComposeColors(
        background = background.value, // background.value åœ¨æ¯ä¸€å¸§éƒ½åœ¨å˜åŒ–
        // ... å…¶ä»–é¢œè‰²ä¹Ÿåœ¨å˜åŒ–
    )
    ```

6.  **æä¾›æ–°çš„é¢œè‰²çŠ¶æ€**: `CompositionLocalProvider(LocalWeComposeColors provides colors)` ä¼šå°†è¿™ä¸ªåŒ…å«ç€**ä¸­é—´é¢œè‰²**çš„æ–° `colors` å¯¹è±¡æä¾›ç»™æ‰€æœ‰ä¸‹å±‚çš„ Composableã€‚

7.  **UI åˆ·æ–°**: æ‰€æœ‰ä½¿ç”¨äº† `WeComposeTheme.colors.background` çš„ç»„ä»¶éƒ½ä¼šè¯»å–åˆ°è¿™ä¸ªæ–°çš„ä¸­é—´è‰²ï¼Œå¹¶ç”¨å®ƒæ¥é‡ç»˜è‡ªå·±ã€‚

è¿™ä¸ªè¿‡ç¨‹åœ¨ 600 æ¯«ç§’å†…ä¸æ–­é‡å¤ï¼Œæœ€ç»ˆå‘ˆç°å‡ºé¢œè‰²å¹³æ»‘è¿‡æ¸¡çš„åŠ¨ç”»æ•ˆæœã€‚

-----

### \#\# ä¸ºä»€ä¹ˆ `val` ä¸å¤Ÿå¥½ï¼Ÿ`var by mutableStateOf` çš„ä¼˜åŠ¿

ç°åœ¨å›åˆ°ä½ çš„æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ `val`ï¼Ÿ

å¦‚æœ `WeComposeColors` åªæ˜¯ä¸€ä¸ªç®€å•çš„ `data class` å¹¶ä¸”æ‰€æœ‰å±æ€§éƒ½æ˜¯ `val`ï¼š

```kotlin
// è®¾æƒ³ä¸­çš„ç®€åŒ–ç‰ˆ
data class WeComposeColors(
    val background: Color,
    val bottomBar: Color,
    // ...
)
```

è¿™æ®µä»£ç åœ¨ä¸Šé¢çš„åŠ¨ç”»æµç¨‹ä¸­**ä¾ç„¶å¯ä»¥å·¥ä½œ**ã€‚å› ä¸ºåœ¨æ¯ä¸€å¸§ï¼Œä½ åŒæ ·æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ã€åŒ…å«äº†ä¸­é—´é¢œè‰²çš„ `WeComposeColors` å®ä¾‹ã€‚

**é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆåŸä½œè€…è¦ç”¨ `var by mutableStateOf` è¿™ç§çœ‹èµ·æ¥æ›´å¤æ‚çš„å†™æ³•å‘¢ï¼Ÿ**

è¿™ä¸»è¦å…³ä¹ **Compose çš„çŠ¶æ€ç®¡ç†å“²å­¦å’Œç¨³å®šæ€§**ã€‚

1.  **æ˜ç¡®çš„çŠ¶æ€æŒæœ‰è€… (State Holder)**: `var by mutableStateOf(...)` æ˜ç¡®åœ°å°† `WeComposeColors` å®šä¹‰ä¸ºä¸€ä¸ª**çŠ¶æ€æŒæœ‰è€…**ã€‚å®ƒçš„æ¯ä¸€ä¸ªå±æ€§æœ¬èº«å°±æ˜¯ä¸€ä¸ª**å¯è§‚å¯Ÿçš„çŠ¶æ€ (`State<T>`)**ã€‚è¿™æ˜¯ä¸€ç§æ›´ç¬¦åˆ Compose è®¾è®¡æ€æƒ³çš„æ¨¡å¼ã€‚å½“ä¸€ä¸ªå±æ€§ï¼ˆä¾‹å¦‚ `background`ï¼‰çš„å€¼è¢«æ›´æ–°æ—¶ï¼ŒCompose æ¡†æ¶èƒ½ç²¾ç¡®åœ°çŸ¥é“åªæœ‰è¯»å–äº† `colors.background` çš„é‚£äº› Composable éœ€è¦é‡ç»„ã€‚

2.  **`@Stable` æ³¨è§£çš„æ„ä¹‰**: `@Stable` æ˜¯ä½ ç»™ Compose ç¼–è¯‘å™¨çš„ä¸€ä¸ªâ€œæ‰¿è¯ºâ€ã€‚ä½ å‘Šè¯‰å®ƒï¼š

      * è¿™ä¸ªç±»çš„æ‰€æœ‰å…¬å…±å±æ€§è¦ä¹ˆæ˜¯ `val` çš„ç¨³å®šç±»å‹ï¼Œè¦ä¹ˆæ˜¯ `var` çš„ `State<T>` ç±»å‹ã€‚
      * å½“è¿™ä¸ªç±»çš„å®ä¾‹åœ¨é‡ç»„å‰åæ²¡æœ‰å˜åŒ–æ—¶ï¼Œä½ å¯ä»¥å®‰å…¨åœ°è·³è¿‡è¿™ä¸ªç»„ä»¶çš„é‡ç»„ã€‚

    é€šè¿‡ä½¿ç”¨ `var by mutableStateOf`ï¼Œ`WeComposeColors` çš„æ¯ä¸ªå±æ€§éƒ½å˜æˆäº† `State` å¯¹è±¡ï¼Œè¿™å®Œå…¨ç¬¦åˆ `@Stable` çš„è¦æ±‚ã€‚Compose çŸ¥é“è¿™ä¸ªå¯¹è±¡æ˜¯ç¨³å®šçš„ï¼Œå®ƒåªä¼šå› ä¸ºå…¶å†…éƒ¨çš„ `State` å˜åŒ–è€Œè§¦å‘ä¸‹æ¸¸çš„é‡ç»„ï¼Œä»è€Œå®ç°æ›´ç²¾ç»†ã€æ›´é«˜æ•ˆçš„ UI æ›´æ–°ã€‚

3.  **çµæ´»æ€§**: è™½ç„¶å½“å‰ä»£ç æ²¡æœ‰ç”¨åˆ°ï¼Œä½†è¿™ç§è®¾è®¡å…è®¸ä½ åœ¨å°†æ¥**åªæ›´æ–°å•ä¸ªé¢œè‰²**ï¼Œè€Œä¸æ˜¯æ›¿æ¢æ•´ä¸ª `WeComposeColors` å¯¹è±¡ã€‚`private set` ç¡®ä¿äº†è¿™ç§æ›´æ–°åªèƒ½åœ¨ç±»çš„å†…éƒ¨ï¼ˆæˆ–è€…é€šè¿‡ç‰¹å®šçš„å‡½æ•°ï¼‰å‘ç”Ÿï¼Œä¿æŒäº†çŠ¶æ€çš„å¯æ§æ€§ã€‚

-----

### \#\# æ€»ç»“

æ€»è€Œè¨€ä¹‹ï¼Œä½ æå‡ºçš„ç”¨ `val` çš„æ–¹æ¡ˆåœ¨**å½“å‰è¿™ä¸ªåŠ¨ç”»åœºæ™¯ä¸‹æ˜¯å¯è¡Œçš„**ã€‚

ä½†ä½œè€…é‡‡ç”¨ `var by mutableStateOf` å’Œ `@Stable` çš„ç»„åˆï¼Œæ˜¯ä¸€ç§**æ›´è§„èŒƒã€æ›´å¥å£®ã€æ›´ç¬¦åˆ Compose çŠ¶æ€ç®¡ç†æ€æƒ³**çš„å®è·µã€‚å®ƒå°† `WeComposeColors` ä»ä¸€ä¸ªç®€å•çš„â€œæ•°æ®å®¹å™¨â€æå‡ä¸ºäº†ä¸€ä¸ªâ€œç¨³å®šçš„çŠ¶æ€æŒæœ‰è€…â€ï¼Œè¿™è®© Compose ç¼–è¯‘å™¨èƒ½æ›´å¥½åœ°ä¼˜åŒ–é‡ç»„è¿‡ç¨‹ï¼Œä¹Ÿè®©ä»£ç åœ¨æœªæ¥æ›´å…·æ‰©å±•æ€§ã€‚

æ‰€ä»¥ï¼Œè™½ç„¶å®ƒçœ‹èµ·æ¥â€œæ€ªæ€ªçš„â€ï¼Œä½†èƒŒåæ˜¯å‡ºäºå¯¹ Compose å·¥ä½œåŸç†çš„æ·±åˆ»ç†è§£å’Œå¯¹ä»£ç é•¿è¿œå¥å£®æ€§çš„è€ƒè™‘ã€‚ğŸ‘

---------------------------------------------------------------------------------------------------


  var theme by mutableStateOf(WeComposeTheme.Theme.Light)

   Modifier
            .clickable {
              viewModel.theme = when (viewModel.theme) {
                WeComposeTheme.Theme.Light -> WeComposeTheme.Theme.Dark
                WeComposeTheme.Theme.Dark -> WeComposeTheme.Theme.NewYear
                WeComposeTheme.Theme.NewYear -> WeComposeTheme.Theme.Light
              }
            }

   è¿™æ ·å°±å®ç°äº†åŠ¨æ€ç›‘å¬äº†

   setContent {
            WeComposeTheme(mViewModel.theme) {
                Box {
                    Home(mViewModel)
                    ChatPage()
                }
            }
        }
    å¯¼è‡´æ ¹é‡ç»„äº†


    è¿™ä¸ªæ‰§è¡Œäº†

@Composable
fun WeComposeTheme(
    theme: WeComposeTheme.Theme = WeComposeTheme.Theme.Light,
    content: @Composable() () -> Unit
) {
    val targetColors = when (theme) {
        WeComposeTheme.Theme.Light -> LightColorPalette
        WeComposeTheme.Theme.Dark -> DarkColorPalette
        WeComposeTheme.Theme.NewYear -> NewYearColorPalette
    }

    val bottomBar = animateColorAsState(targetColors.bottomBar, TweenSpec(600))
    val background = animateColorAsState(targetColors.background, TweenSpec(600))
    val listItem = animateColorAsState(targetColors.listItem, TweenSpec(600))
    val chatListDivider = animateColorAsState(targetColors.chatListDivider, TweenSpec(600))
    val chatPage = animateColorAsState(targetColors.chatPage, TweenSpec(600))
    val textPrimary = animateColorAsState(targetColors.textPrimary, TweenSpec(600))
    val textPrimaryMe = animateColorAsState(targetColors.textPrimaryMe, TweenSpec(600))
    val textSecondary = animateColorAsState(targetColors.textSecondary, TweenSpec(600))
    val onBackground = animateColorAsState(targetColors.onBackground, TweenSpec(600))
    val icon = animateColorAsState(targetColors.icon, TweenSpec(600))
    val iconCurrent = animateColorAsState(targetColors.iconCurrent, TweenSpec(600))
    val badge = animateColorAsState(targetColors.badge, TweenSpec(600))
    val onBadge = animateColorAsState(targetColors.onBadge, TweenSpec(600))
    val bubbleMe = animateColorAsState(targetColors.bubbleMe, TweenSpec(600))
    val bubbleOthers = animateColorAsState(targetColors.bubbleOthers, TweenSpec(600))
    val textFieldBackground = animateColorAsState(targetColors.textFieldBackground, TweenSpec(600))
    val more = animateColorAsState(targetColors.more, TweenSpec(600))
    val chatPageBgAlpha = animateFloatAsState(targetColors.chatPageBgAlpha, TweenSpec(600))

    val colors = WeComposeColors(
        bottomBar = bottomBar.value,
        background = background.value,
        listItem = listItem.value,
        divider = chatListDivider.value,
        chatPage = chatPage.value,
        textPrimary = textPrimary.value,
        textPrimaryMe = textPrimaryMe.value,
        textSecondary = textSecondary.value,
        onBackground = onBackground.value,
        icon = icon.value,
        iconCurrent = iconCurrent.value,
        badge = badge.value,
        onBadge = onBadge.value,
        bubbleMe = bubbleMe.value,
        bubbleOthers = bubbleOthers.value,
        textFieldBackground = textFieldBackground.value,
        more = more.value,
        chatPageBgAlpha = chatPageBgAlpha.value,
    )

    CompositionLocalProvider(LocalWeComposeColors provides colors) {
        MaterialTheme(
            shapes = shapes,
            content = content
        )
    }
}

é—®é¢˜éœ€è¦æµ‹è¯• WeComposeColors  è¿™ä¸ªåœ°æ–¹è¢«åˆ›å»ºäº†å¤šå°‘æ¬¡  
---------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------