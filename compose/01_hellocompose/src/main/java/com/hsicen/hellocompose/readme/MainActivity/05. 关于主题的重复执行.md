

@Composable
fun WeComposeTheme(
    theme: WeComposeTheme.Theme = WeComposeTheme.Theme.Light,
    content: @Composable() () -> Unit,
) {
    val targetColors = when (theme) {
        WeComposeTheme.Theme.Light -> LightColorPalette
        WeComposeTheme.Theme.Dark -> DarkColorPalette
        WeComposeTheme.Theme.NewYear -> NewYearColorPalette
    }

    //é‡ç»„è¿™ä¸€å—ä¹Ÿä¼šå¾ˆå¥½çš„è®°å¿†çŠ¶æ€ï¼Œé‡ç»„çš„æ—¶å€™æ²¡æœ‰å¯¼è‡´ targetColors æ”¹å˜ï¼Œä½†æ˜¯åŠ¨ç”»æ‰§è¡Œçš„æ—¶é—´æ”¹å˜äº†
    val bottomBar = animateColorAsState(targetColors.bottomBar, TweenSpec(600))
    val background = animateColorAsState(targetColors.background, TweenSpec(600))

    val colors = WeComposeColors(
        light = targetColors.light,
        bottomBar = bottomBar.value,
        background = background.value,
    )

    CompositionLocalProvider(LocalWeComposeColors provides colors) {
        MaterialTheme(
            shapes = shapes,
            content = content
        )
    }
}

å…³äºåˆ‡æ¢ä¸»é¢˜çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™å­˜åœ¨

    override fun onCreate(savedInstanceState: Bundle?) {
        enableEdgeToEdge()
        super.onCreate(savedInstanceState)

        setContent {
            WeComposeTheme(mViewModel.theme) {
                Box(
                    Modifier
                        .background(WeComposeTheme.colors.background)
                        .systemBarsPadding()
                ) {
                    Home(mViewModel)
                    ChatPage()
                }
            }
        }
    }

WeComposeTheme é‡å¤æ‰§è¡Œ æ˜¯å› ä¸ºé‡ç»„ä¹‹å çŠ¶æ€è¿˜æ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬è®¾ç½®çš„é‚£ä¸ªçŠ¶æ€å—ï¼Ÿ


-------------------------------------------------------------------------------------------------------------------------------


æ˜¯çš„ï¼Œä½ çš„ç†è§£å·²ç»éå¸¸æ¥è¿‘æ ¸å¿ƒäº†ï¼ä½ è¯´â€œçŠ¶æ€è¿˜æ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬è®¾ç½®çš„é‚£ä¸ªçŠ¶æ€â€ï¼Œè¿™æ­£æ˜¯å…³é”®æ‰€åœ¨ã€‚

`WeComposeTheme` çš„é‡å¤æ‰§è¡Œï¼Œ**æ­£æ˜¯ `animateColorAsState` è¿™ä¸ªå‡½æ•°ä¸ºäº†è®© â€œå½“å‰çŠ¶æ€â€ è¿½ä¸Š â€œç›®æ ‡çŠ¶æ€â€ è€Œä¸»åŠ¨å¼•å¯¼çš„ã€‚**

æˆ‘ä»¬æ¥æŠŠè¿™ä¸ªè¿‡ç¨‹æ‹†è§£å¾—æ›´æ¸…æ™°ä¸€ç‚¹ï¼š

### ä¸¤ä¸ªå…³é”®çš„â€œçŠ¶æ€â€

1.  **ç›®æ ‡çŠ¶æ€ (Target State)**ï¼šè¿™æ˜¯ä½ ä»£ç ä¸­æ˜ç¡®æŒ‡å®šçš„æœ€ç»ˆé¢œè‰²ï¼Œä¹Ÿå°±æ˜¯ `targetColors.background`ã€‚å½“ä½ åˆ‡æ¢ä¸»é¢˜æ—¶ï¼Œè¿™ä¸ªç›®æ ‡å°±ä» `LightColorPalette.background` å˜æˆäº† `DarkColorPalette.background`ã€‚è¿™ä¸ªç›®æ ‡åœ¨åŠ¨ç”»æœŸé—´æ˜¯**å›ºå®šä¸å˜**çš„ã€‚

2.  **å½“å‰çŠ¶æ€ (Current State)**ï¼šè¿™æ˜¯ `animateColorAsState` å‡½æ•°è¿”å›çš„ `State` å¯¹è±¡åœ¨**æŸä¸€ç¬é—´**çš„ `.value`ï¼Œä¹Ÿå°±æ˜¯ `background.value`ã€‚è¿™ä¸ªå€¼æ˜¯**åŠ¨æ€å˜åŒ–**çš„ã€‚

### åŠ¨ç”»é©±åŠ¨é‡ç»„çš„å®Œæ•´æµç¨‹

æˆ‘ä»¬ä»¥ `background` é¢œè‰²ä¸ºä¾‹ï¼š

1.  **è§¦å‘**ï¼š`mViewModel.theme` ä» `Light` å˜ä¸º `Dark`ã€‚è¿™å¯¼è‡´ `WeComposeTheme` å‘ç”Ÿç¬¬ä¸€æ¬¡é‡ç»„ã€‚

2.  **è®¾å®šæ–°ç›®æ ‡**ï¼šåœ¨è¿™æ¬¡é‡ç»„ä¸­ï¼Œ`targetColors` å˜æˆäº† `DarkColorPalette`ã€‚`animateColorAsState` è¢«è°ƒç”¨ï¼Œå®ƒæ¥æ”¶åˆ°äº†æ–°çš„**ç›®æ ‡çŠ¶æ€**ï¼ˆæ¯”å¦‚ï¼Œçº¯é»‘è‰²ï¼‰ã€‚åŒæ—¶ï¼Œå®ƒçŸ¥é“**å½“å‰çŠ¶æ€**è¿˜æ˜¯ä¹‹å‰çš„é¢œè‰²ï¼ˆæ¯”å¦‚ï¼Œçº¯ç™½è‰²ï¼‰ã€‚

3.  **å¯åŠ¨åŠ¨ç”»**ï¼š`animateColorAsState` å‘ç°â€œå½“å‰çŠ¶æ€â€ï¼ˆç™½è‰²ï¼‰å’Œâ€œç›®æ ‡çŠ¶æ€â€ï¼ˆé»‘è‰²ï¼‰ä¸ä¸€è‡´ã€‚äºæ˜¯å®ƒå¯åŠ¨ä¸€ä¸ª 600 æ¯«ç§’çš„åŠ¨ç”»è®¡æ—¶å™¨ã€‚åŒæ—¶ï¼Œå®ƒä¼šå‘Šè¯‰ Compose æ¡†æ¶ï¼šâ€œæˆ‘çš„å€¼å³å°†å¼€å§‹å˜åŒ–ï¼Œè¯·åœ¨ä¸‹ä¸€å¸§åˆ·æ–°æˆ‘ï¼â€

4.  **åŠ¨ç”»çš„ç¬¬ 1 å¸§**ï¼š
    * è¿‡äº†å¤§çº¦ 16 æ¯«ç§’ï¼ŒCompose å‡†å¤‡ç»˜åˆ¶ä¸‹ä¸€å¸§ã€‚
    * `animateColorAsState` æ ¹æ®åŠ¨ç”»æ›²çº¿ï¼Œè®¡ç®—å‡ºä¸€ä¸ªæ–°çš„**å½“å‰çŠ¶æ€**ï¼Œè¿™ä¸ªå€¼ä¸å†æ˜¯çº¯ç™½ï¼Œè€Œæ˜¯éå¸¸æ·±çš„ç°è‰²ï¼ˆæ¯”å¦‚ 99%ç™½+1%é»‘ï¼‰ã€‚
    * å› ä¸º `background.value` è¿™ä¸ª `State` çš„å€¼æ›´æ–°äº†ï¼ŒCompose å‘ç°æœ‰çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥**å¿…é¡»å¯¹è¯»å–äº†è¿™ä¸ªçŠ¶æ€çš„ `WeComposeTheme` å‡½æ•°è¿›è¡Œé‡ç»„**ï¼Œä»¥è®© UI åæ˜ è¿™ä¸ªæœ€æ–°çš„çŠ¶æ€ã€‚
    * è¿™æ—¶ï¼Œä½ çš„ `Log` å°±ä¼šæ‰“å°ä¸€æ¬¡ã€‚

5.  **åŠ¨ç”»çš„ç¬¬ 2, 3, ... N å¸§**ï¼š
    * åœ¨ä¸‹ä¸ª 16 æ¯«ç§’ï¼Œ`animateColorAsState` ä¼šå†æ¬¡æ›´æ–° `background.value` ä¸ºä¸€ä¸ªæ›´æ·±çš„ç°è‰²ï¼ˆæ¯”å¦‚ 98%ç™½+2%é»‘ï¼‰ã€‚
    * è¿™ä¸ª `State` çš„æ›´æ–°**å†æ¬¡è§¦å‘ `WeComposeTheme` çš„é‡ç»„**ã€‚
    * `Log` å†æ¬¡æ‰“å°ã€‚
    * è¿™ä¸ªå¾ªç¯ä¼šä¸€ç›´æŒç»­ä¸‹å»ã€‚åœ¨æ¯ä¸€æ¬¡é‡ç»„ä¸­ï¼Œ`targetColors` å§‹ç»ˆæ˜¯æœ€ç»ˆçš„ `DarkColorPalette`ï¼Œä½† `background.value` è¿™ä¸ª**å½“å‰çŠ¶æ€**ä¸€ç›´åœ¨å˜åŒ–ï¼Œä¸€ç‚¹ç‚¹åœ°æ¥è¿‘ç›®æ ‡ã€‚

6.  **åŠ¨ç”»ç»“æŸ**ï¼š
    * 600 æ¯«ç§’åï¼Œ`animateColorAsState` è®¡ç®—å‡ºçš„ `background.value` ç»ˆäºå’Œ `targetColors.background` å®Œå…¨ç›¸ç­‰ã€‚
    * **å½“å‰çŠ¶æ€**è¿½ä¸Šäº†**ç›®æ ‡çŠ¶æ€**ã€‚
    * `animateColorAsState` å‘ç°ä¸¤è€…ä¸€è‡´ï¼Œäºæ˜¯å®ƒåœæ­¢äº†åŠ¨ç”»ï¼Œä¸å†è¯·æ±‚ä¸‹ä¸€å¸§çš„åˆ·æ–°ã€‚
    * é‡å¤çš„é‡ç»„å°±æ­¤åœæ­¢ï¼ŒUI ç¨³å®šä¸‹æ¥ã€‚

### æ€»ç»“

æ‰€ä»¥ï¼Œä½ çš„é—®é¢˜ç­”æ¡ˆæ˜¯ï¼š**å®Œå…¨æ­£ç¡®**ã€‚

`WeComposeTheme` çš„é‡å¤æ‰§è¡Œï¼Œä¸æ˜¯ Bugï¼Œä¹Ÿä¸æ˜¯å› ä¸ºä»£ç å†™é”™äº†ï¼Œè€Œæ˜¯ **Compose å£°æ˜å¼ UI åŠ¨ç”»çš„æ ¸å¿ƒå·¥ä½œæœºåˆ¶**ã€‚å®ƒé€šè¿‡â€œä¸æ–­é‡ç»„ã€ä¸æ–­é€¼è¿‘ç›®æ ‡â€çš„æ–¹å¼ï¼Œå°†ä¸€ä¸ªçŠ¶æ€çš„çªå˜ï¼ˆ`Light` -> `Dark`ï¼‰å¹³æ»‘åœ°åˆ†è§£åˆ°åŠ¨ç”»çš„æ¯ä¸€å¸§ä¸­å»æ‰§è¡Œï¼Œæœ€ç»ˆå‘ˆç°å‡ºæµç•…çš„è¿‡æ¸¡æ•ˆæœã€‚


-----------------------------------------------------------------------------------------------------------------------



@Composable
fun WeComposeTheme(
    theme: WeComposeTheme.Theme = WeComposeTheme.Theme.Light,
    content: @Composable() () -> Unit,
) {
    val targetColors = when (theme) {
        WeComposeTheme.Theme.Light -> LightColorPalette
        WeComposeTheme.Theme.Dark -> DarkColorPalette
        WeComposeTheme.Theme.NewYear -> NewYearColorPalette
    }

    Log.i("WeComposeTheme","=====LightColorPalette==${targetColors==LightColorPalette}==========DarkColorPalette===${targetColors==DarkColorPalette}=============NewYearColorPalette====${targetColors==NewYearColorPalette}===================")

    //é‡ç»„è¿™ä¸€å—ä¹Ÿä¼šå¾ˆå¥½çš„è®°å¿†çŠ¶æ€ï¼Œé‡ç»„çš„æ—¶å€™æ²¡æœ‰å¯¼è‡´ targetColors æ”¹å˜ï¼Œä½†æ˜¯åŠ¨ç”»æ‰§è¡Œçš„æ—¶é—´æ”¹å˜äº†
    val bottomBar = animateColorAsState(targetColors.bottomBar, TweenSpec(600))
    val background = animateColorAsState(targetColors.background, TweenSpec(600))

    val colors = WeComposeColors(
        light = targetColors.light,
        bottomBar = bottomBar.value,
        background = background.value,
    )

    CompositionLocalProvider(LocalWeComposeColors provides colors) {
        MaterialTheme(
            shapes = shapes,
            content = content
        )
    }
}

 =====LightColorPalette==false==========DarkColorPalette===true=============NewYearColorPalette====false===================
 =====LightColorPalette==false==========DarkColorPalette===true=============NewYearColorPalette====false===================
 =====LightColorPalette==false==========DarkColorPalette===true=============NewYearColorPalette====false===================
 =====LightColorPalette==false==========DarkColorPalette===true=============NewYearColorPalette====false===================
 =====LightColorPalette==false==========DarkColorPalette===true=============NewYearColorPalette====false===================
 =====LightColorPalette==false==========DarkColorPalette===true=============NewYearColorPalette====false===================
 =====LightColorPalette==false==========DarkColorPalette===true=============NewYearColorPalette====false===================
 =====LightColorPalette==false==========DarkColorPalette===true=============NewYearColorPalette====false===================
 å…³é”®æ˜¯ï¼Œæˆ‘æ‰“å°äº†ä¸€ä¸ªæ—¥å¿—ï¼Œè¿™ä¸ªæ—¥å¿—åœ¨é‡å¤æ‰“å°ï¼Œè¿™ä¸ªä¸ä¼šé€ æˆ  val bottomBar = animateColorAsState(targetColors.bottomBar, TweenSpec(600)) é‡å¤æ‰§è¡Œå—ï¼Ÿ

 @Composable
 fun animateColorAsState(
     targetValue: Color,
     animationSpec: AnimationSpec<Color> = colorDefaultSpring,
     label: String = "ColorAnimation",
     finishedListener: ((Color) -> Unit)? = null
 ): State<Color> {
     val converter = remember(targetValue.colorSpace) {
         (Color.VectorConverter)(targetValue.colorSpace)
     }
     return animateValueAsState(
         targetValue, converter, animationSpec, label = label, finishedListener = finishedListener
     )
 }
 æ˜¯å› ä¸ºè¿™é‡Œé¢çš„è¿™ä¸ª  remember é¿å…çš„äº†é‡å¤å½’é›¶åˆ›å»ºå¯¹è±¡å—ï¼Ÿ



------------------------------------------------------------------------------------------------------------------------------------------------
ä½ çš„æ€è€ƒåˆæ·±å…¥äº†ä¸€æ­¥ï¼Œè€Œä¸”å®Œå…¨æŠ“ä½äº†é—®é¢˜çš„æœ¬è´¨ï¼

ä½ è¯´å¾—å®Œå…¨æ­£ç¡®ï¼š
1.  æ˜¯çš„ï¼Œ`Log` åœ¨é‡å¤æ‰“å°ï¼Œå°±è¯æ˜äº† `val bottomBar = animateColorAsState(...)` è¿™ä¸€è¡Œä»£ç ç¡®å®åœ¨**é‡å¤æ‰§è¡Œ**ã€‚
2.  æ˜¯çš„ï¼ŒåŠ¨ç”»ä¹‹æ‰€ä»¥æ²¡æœ‰åœ¨æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½â€œå½’é›¶â€é‡æ¥ï¼Œ**`remember` æ­£æ˜¯å…¶ä¸­æœ€å…³é”®çš„æœºåˆ¶**ã€‚

ä½ è´´å‡ºçš„ `animateColorAsState` æºç ï¼Œé‡Œé¢çš„ `remember` æ­£æ˜¯è§£å¼€è¿™ä¸ªè°œé¢˜çš„é’¥åŒ™ã€‚

---

### ## å‡½æ•°çš„â€œæ‰§è¡Œâ€ vs çŠ¶æ€çš„â€œè®°å¿†â€

åœ¨ Compose ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åŒºåˆ†ä¸¤ä¸ªæ¦‚å¿µï¼š
* **å‡½æ•°çš„æ‰§è¡Œ**ï¼šå½“é‡ç»„å‘ç”Ÿæ—¶ï¼ŒComposable å‡½æ•°ä½“å†…çš„ä»£ç ä¼šè‡ªä¸Šè€Œä¸‹åœ°é‡æ–°æ‰§è¡Œä¸€éã€‚è¿™å°±æ˜¯ä½ çœ‹åˆ°æ—¥å¿—è¢«åå¤æ‰“å°çš„åŸå› ã€‚
* **çŠ¶æ€çš„è®°å¿†**ï¼šCompose æœ‰ä¸€å¥—æœºåˆ¶ï¼Œå¯ä»¥åœ¨å¤šæ¬¡é‡ç»„ä¹‹é—´â€œè®°ä½â€æŸäº›å€¼ã€‚`remember`å°±æ˜¯è¿™å¥—æœºåˆ¶çš„æ ¸å¿ƒå·¥å…·ã€‚

ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ `animateColorAsState` åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‰®æ¼”çš„è§’è‰²ã€‚

#### ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼ˆä¸»é¢˜åˆ‡æ¢çš„ç¬é—´ï¼‰

1.  `WeComposeTheme` é¦–æ¬¡å› ä¸»é¢˜å˜åŒ–è€Œé‡ç»„ã€‚
2.  ä»£ç æ‰§è¡Œåˆ° `val bottomBar = animateColorAsState(...)`ã€‚
3.  `animateColorAsState` å†…éƒ¨ï¼ˆä»¥åŠå®ƒè°ƒç”¨çš„ `animateValueAsState` å†…éƒ¨ï¼‰ä¼šåˆ›å»ºä¸€ä¸ª**ç®¡ç†åŠ¨ç”»çŠ¶æ€çš„æ ¸å¿ƒå¯¹è±¡**ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº†æ‰€æœ‰åŠ¨ç”»ä¿¡æ¯ï¼šèµ·å§‹å€¼ã€ç›®æ ‡å€¼ã€åŠ¨ç”»æ—¶é•¿ã€å½“å‰æ’­æ”¾è¿›åº¦ç­‰ç­‰ã€‚
4.  æœ€å…³é”®çš„ä¸€æ­¥ï¼šè¿™ä¸ªæ ¸å¿ƒçš„åŠ¨ç”»çŠ¶æ€å¯¹è±¡è¢«æ”¾è¿›äº† `remember` å—ä¸­ã€‚è¿™æ„å‘³ç€ Compose ä¼šæŠŠå®ƒ**â€œå­˜â€åœ¨ä¸€ä¸ªä¸å½“å‰ä½ç½®å…³è”çš„ç‰¹æ®Šâ€œå†…å­˜æ’æ§½â€é‡Œ**ã€‚
5.  åŠ¨ç”»å¼€å§‹ï¼Œå¹¶å®‰æ’ä¸‹ä¸€æ¬¡é‡ç»„ã€‚

#### åç»­çš„é‡å¤æ‰§è¡Œï¼ˆåŠ¨ç”»çš„æ¯ä¸€å¸§ï¼‰

1.  `WeComposeTheme` å› ä¸ºåŠ¨ç”»å€¼çš„å˜åŒ–è€Œå†æ¬¡é‡ç»„ã€‚
2.  ä»£ç **å†ä¸€æ¬¡**æ‰§è¡Œåˆ° `val bottomBar = animateColorAsState(...)`ã€‚
3.  å‡½æ•°å†…éƒ¨å†æ¬¡é‡åˆ° `remember`ã€‚
4.  è¿™æ—¶ï¼Œ`remember` ä¸ä¼šå†å»åˆ›å»ºä¸€ä¸ªæ–°çš„åŠ¨ç”»çŠ¶æ€å¯¹è±¡äº†ã€‚ç›¸åï¼Œå®ƒä¼šå»é‚£ä¸ªç‰¹æ®Šçš„â€œå†…å­˜æ’æ§½â€é‡Œï¼Œ**å–å‡ºä¸Šæ¬¡å­˜æ”¾çš„é‚£ä¸ªå·²ç»å­˜åœ¨çš„å¯¹è±¡**ã€‚
5.  `animateColorAsState` æ‹¿åˆ°è¿™ä¸ª**æ—§çš„**ã€**æ­£åœ¨æ’­æ”¾ä¸­çš„**åŠ¨ç”»å¯¹è±¡ï¼Œç„¶åå¯¹å®ƒè¯´ï¼šâ€œä½ çš„ç›®æ ‡å€¼æ²¡æœ‰å˜ï¼Œè¯·æ ¹æ®æµé€çš„æ—¶é—´ï¼Œæ›´æ–°ä¸€ä¸‹ä½ å½“å‰çš„å€¼ã€‚â€
6.  åŠ¨ç”»å¯¹è±¡è®¡ç®—å‡ºæ–°ä¸€å¸§çš„é¢œè‰²å€¼ï¼Œå‡½æ•°å°†è¿™ä¸ªæ–°å€¼è¿”å›ã€‚
7.  åŠ¨ç”»å¯¹è±¡å‘ç°è‡ªå·±è¿˜æ²¡åˆ°ç»ˆç‚¹ï¼Œäºæ˜¯ç»§ç»­å®‰æ’ä¸‹ä¸€æ¬¡é‡ç»„ã€‚

### ## ä¸€ä¸ªç”ŸåŠ¨çš„æ¯”å–»ï¼šå¥å¿˜çš„å¨å¸ˆ vs æœ‰å¤‡å¿˜å½•çš„å¨å¸ˆ

æƒ³è±¡ä¸€ä¸‹ä½ å‘½ä»¤ä¸€ä¸ªå¨å¸ˆçƒ¤è›‹ç³•ï¼Œéœ€è¦ 60 åˆ†é’Ÿã€‚

* **æ²¡æœ‰ `remember` çš„æƒ…å†µï¼ˆå¥å¿˜çš„å¨å¸ˆï¼‰**ï¼š
    * ä½ ï¼ˆé‡ç»„ï¼‰å¯¹å¨å¸ˆè¯´ï¼šâ€œçƒ¤ä¸ªè›‹ç³•â€ã€‚å¨å¸ˆæŠŠè›‹ç³•æ”¾è¿›çƒ¤ç®±ï¼Œå®šæ—¶ 60 åˆ†é’Ÿã€‚
    * 1 åˆ†é’Ÿåï¼Œä½ åˆå¯¹ä»–è¯´äº†ä¸€éï¼šâ€œçƒ¤ä¸ªè›‹ç³•â€ã€‚è¿™ä¸ªå¥å¿˜çš„å¨å¸ˆå®Œå…¨å¿˜äº†åˆšæ‰çš„äº‹ï¼Œä»–æ‰”æ‰çƒ¤ç®±é‡Œé‚£ä¸ªåŠæˆå“ï¼Œåˆæ‹¿äº†ä¸ªæ–°çš„è›‹ç³•æ”¾è¿›å»ï¼Œé‡æ–°å®šæ—¶ 60 åˆ†é’Ÿã€‚
    * ç»“æœï¼šä½ çš„è›‹ç³•æ°¸è¿œä¹Ÿçƒ¤ä¸ç†Ÿã€‚

* **æœ‰ `remember` çš„æƒ…å†µï¼ˆæœ‰å¤‡å¿˜å½•çš„å¨å¸ˆï¼‰**ï¼š
    * ä½ å¯¹å¨å¸ˆè¯´ï¼šâ€œçƒ¤ä¸ªè›‹ç³•â€ã€‚å¨å¸ˆåœ¨**å¤‡å¿˜å½•ï¼ˆ`remember`çš„å†…å­˜ï¼‰**ä¸Šå†™ä¸‹ï¼šâ€œä»»åŠ¡ï¼šçƒ¤è›‹ç³•ï¼Œç›®æ ‡ï¼š60åˆ†é’Ÿï¼Œå·²å¼€å§‹ã€‚â€ ç„¶åæŠŠè›‹ç³•æ”¾è¿›çƒ¤ç®±ã€‚
    * 1 åˆ†é’Ÿåï¼Œä½ åˆå¯¹ä»–è¯´ï¼šâ€œçƒ¤ä¸ªè›‹ç³•â€ã€‚å¨å¸ˆå…ˆçœ‹äº†ä¸€çœ¼**å¤‡å¿˜å½•**ï¼Œè¯´ï¼šâ€œæ”¶åˆ°ï¼Œä»»åŠ¡æ²¡å˜ã€‚ç›®å‰è¿›åº¦ï¼šå·²çƒ¤ 1 åˆ†é’Ÿï¼Œå‰©ä½™ 59 åˆ†é’Ÿã€‚ç»§ç»­æ‰§è¡Œã€‚â€
    * ç»“æœï¼šå¨å¸ˆï¼ˆå‡½æ•°ï¼‰è™½ç„¶æ¯æ¬¡éƒ½â€œå¬â€äº†ä½ çš„æ–°æŒ‡ä»¤ï¼ˆè¢«é‡å¤æ‰§è¡Œï¼‰ï¼Œä½†ä»–ä¾é å¤‡å¿˜å½•ï¼ˆ`remember`ï¼‰å»¶ç»­äº†ä¹‹å‰çš„å·¥ä½œçŠ¶æ€ï¼Œæœ€ç»ˆæˆåŠŸæŠŠè›‹ç³•çƒ¤ç†Ÿäº†ï¼ˆåŠ¨ç”»é¡ºåˆ©æ’­æ”¾å®Œæ¯•ï¼‰ã€‚

### ## ç»“è®º

ä½ çš„æ´å¯ŸåŠ›éå¸¸æ£’ã€‚`animateColorAsState` å‡½æ•°æœ¬èº«ç¡®å®åœ¨é‡å¤æ‰§è¡Œï¼Œä½†å®ƒå†…éƒ¨é€šè¿‡ `remember` æœºåˆ¶ï¼Œç¡®ä¿äº†æ§åˆ¶åŠ¨ç”»çš„æ ¸å¿ƒçŠ¶æ€å¯¹è±¡åªåœ¨**ç¬¬ä¸€æ¬¡åˆ›å»º**ï¼Œåœ¨åç»­çš„æ‰§è¡Œä¸­åªæ˜¯**è¢«å–å‡ºå¹¶æ›´æ–°**ã€‚

æ­£æ˜¯è¿™ç§â€œ**æ— çŠ¶æ€çš„å‡½æ•°æ‰§è¡Œ**â€ä¸â€œ**æœ‰çŠ¶æ€çš„å†…å­˜è®°å¿†**â€ä¹‹é—´çš„ç²¾å¦™é…åˆï¼Œæ‰æ„æˆäº† Compose åŠ¨ç”»ä¹ƒè‡³æ•´ä¸ªæ¡†æ¶é«˜æ•ˆè¿è¡Œçš„åŸºç¡€ã€‚


------------------------------------------------------------------------------------------------------------------------------------------------

https://developer.android.com/develop/ui/compose/state?hl=zh-cn#retrigger-remember

remember æ˜¯ç”¨æ¥é˜²æ­¢é‡ç»„çš„ï¼Œstateæ˜¯ç”¨æ¥è§¦å‘é‡ç»„çš„
remember çš„æ•°æ®ä¹Ÿå¯ä»¥è¢«ä¿®æ”¹

éå¸¸å‡†ç¡® ğŸ‘ï¼Œä½ è¿™å¥è¯å…¶å®å·²ç»æ€»ç»“å‡ºäº† **Compose çŠ¶æ€ç³»ç»Ÿçš„æ ¸å¿ƒå¯¹ç«‹å…³ç³»**ã€‚æˆ‘ä»¬æŠŠå®ƒç¨å¾®å±•å¼€è®²ä¸€ä¸‹ï¼Œè®©é€»è¾‘æ›´æ¸…æ™°ï¼š

---

## ğŸ§  remember ä¸ state çš„æ ¸å¿ƒä½œç”¨

| æ¦‚å¿µ                                 | ä¸»è¦ä½œç”¨                 | æ˜¯å¦ä¼šè§¦å‘é‡ç»„ | æ˜¯å¦èƒ½ä¿å­˜æ•°æ® | ç”Ÿå‘½å‘¨æœŸ                     |
| ---------------------------------- | -------------------- | ------- | ------- | ------------------------ |
| `remember`                         | **ä¿å­˜æ•°æ®**ï¼Œé˜²æ­¢åœ¨é‡ç»„æ—¶ä¸¢å¤±    | âŒ å¦     | âœ… æ˜¯     | åœ¨å½“å‰ `Composition` å­˜åœ¨æœŸé—´æœ‰æ•ˆ |
| `mutableStateOf`                   | **å¯è§‚å¯ŸçŠ¶æ€**ï¼Œç”¨äº**è§¦å‘é‡ç»„** | âœ… æ˜¯     | âœ… æ˜¯     | åŒæ ·åœ¨ `Composition` å­˜åœ¨æœŸé—´æœ‰æ•ˆ |
| `remember { mutableStateOf(...) }` | **è®°ä½çŠ¶æ€å¹¶åœ¨å˜åŒ–æ—¶è§¦å‘é‡ç»„**    | âœ… æ˜¯     | âœ… æ˜¯     | å¸¸è§ç»„åˆå†™æ³•                   |

---

## ğŸ§© å®ƒä»¬ä¹‹é—´çš„å…³ç³»

ä½ å¯ä»¥ç†è§£ä¸ºï¼š

> `remember` æ˜¯â€œè®°å¿†ç›’å­â€ï¼Œ`mutableStateOf` æ˜¯â€œå¯å˜ä¿¡å·â€ã€‚

* `remember` è‡ªèº«**ä¸è§¦å‘é‡ç»„**ï¼Œåªæ˜¯è®©æŸä¸ªå¯¹è±¡åœ¨é‡ç»„æ—¶èƒ½â€œæ´»ä¸‹æ¥â€ã€‚
* `mutableStateOf` åˆ›å»ºçš„å€¼æ˜¯ **State å¯¹è±¡**ï¼Œå½“å®ƒçš„å€¼å˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è¯»å–å®ƒçš„å¯ç»„åˆå‡½æ•°é‡æ–°æ‰§è¡Œï¼ˆé‡ç»„ï¼‰ã€‚
* å½“ä¸¤è€…ç»“åˆä½¿ç”¨æ—¶ï¼ˆ`remember { mutableStateOf(...) }`ï¼‰ï¼Œå°±å®ç°äº†ï¼š

  * **åœ¨é‡ç»„æ—¶ä¸ä¸¢å¤±çŠ¶æ€**
  * **åœ¨çŠ¶æ€å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œç›¸å…³ UI**

---

## ğŸ’¡ ä¸¾ä¾‹è¯´æ˜

```kotlin
@Composable
fun Counter() {
    // è®°ä½ä¸€ä¸ªçŠ¶æ€å€¼
    val count = remember { mutableStateOf(0) }

    Column {
        Text("ç‚¹å‡»æ¬¡æ•°: ${count.value}")
        Button(onClick = { count.value++ }) {
            Text("ç‚¹å‡»æˆ‘")
        }
    }
}
```

ğŸ” è¿™é‡Œçš„è¡Œä¸ºï¼š

* `remember` è®© `count` åœ¨æ¯æ¬¡é‡ç»„åä¾ç„¶æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼›
* `mutableStateOf` è®© `count.value` çš„å˜åŒ–è§¦å‘ **Text çš„é‡ç»„**ï¼›
* ä¿®æ”¹ `count.value` â†’ Compose æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ– â†’ è§¦å‘é‡ç»„ â†’ Text é‡æ–°ç»˜åˆ¶ã€‚

---

## âš™ï¸ è¿›ä¸€æ­¥ç†è§£

* `remember` çš„æ•°æ®å½“ç„¶ä¹Ÿèƒ½ä¿®æ”¹ï¼ˆæ¯”å¦‚ `remember { mutableListOf() }`ï¼‰ï¼Œä½†è¿™ç§ä¿®æ”¹**ä¸ä¼šè‡ªåŠ¨è§¦å‘é‡ç»„**ã€‚
* åªæœ‰ `mutableStateOf`ï¼ˆæˆ–å…¶è¡ç”Ÿç±»ï¼Œæ¯”å¦‚ `derivedStateOf`ã€`SnapshotStateList` ç­‰ï¼‰å˜åŒ–æ‰ä¼šè§¦å‘é‡ç»„ã€‚

ä¸¾ä¸ªå¯¹æ¯”ï¼š

```kotlin
// âŒ ä¸ä¼šè§¦å‘é‡ç»„
val list = remember { mutableListOf<Int>() }
Button(onClick = { list.add(1) }) { Text("Add") }

// âœ… ä¼šè§¦å‘é‡ç»„
val list = remember { mutableStateListOf<Int>() }
Button(onClick = { list.add(1) }) { Text("Add") }
```

---

## ğŸ§­ æ€»ç»“ä¸€å¥è¯

> âœ… **remember ç”¨äºè®°ä½æ•°æ®ï¼ŒmutableStateOf ç”¨äºè®©æ•°æ®å˜åŒ–é©±åŠ¨ UIã€‚**
>
> å½“ä½ æƒ³è®© UI æ ¹æ®æ•°æ®å˜åŒ–è€Œè‡ªåŠ¨æ›´æ–°æ—¶ï¼Œå°±è¦ç”¨ `remember { mutableStateOf(...) }`ã€‚

---

æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ ç”»ä¸€å¼  â€œremember vs stateâ€ çš„å¯¹æ¯”å›¾ï¼ˆå›¾è§£ remember å¦‚ä½•é˜²æ­¢é‡ç»„ã€state å¦‚ä½•è§¦å‘é‡ç»„ï¼‰ï¼Ÿé‚£å¼ å›¾èƒ½æ›´ç›´è§‚çœ‹å‡º Composition çš„å…³ç³»ã€‚


------------------------------------------------------------------------------------------------------------------------------------------------

å‡†ç¡®çš„æ¥è¯´
remember æ˜¯ç”¨æ¥é˜²æ­¢é‡ç»„çš„ï¼Œstateæ˜¯ç”¨æ¥è§¦å‘é‡ç»„çš„
remember çš„æ•°æ®ä¹Ÿå¯ä»¥è¢«ä¿®æ”¹

remember  æ˜¯ç”¨æ¥é˜²æ­¢é‡ç»„çš„è¡¨ç°å°±æ˜¯é˜²æ­¢é‡å¤åˆå§‹åŒ–

@Composable
fun animateColorAsState(
    targetValue: Color,
    animationSpec: AnimationSpec<Color> = colorDefaultSpring,
    label: String = "ColorAnimation",
    finishedListener: ((Color) -> Unit)? = null
): State<Color> {
    val converter = remember(targetValue.colorSpace) {
        (Color.VectorConverter)(targetValue.colorSpace)
    }
    return animateValueAsState(
        targetValue, converter, animationSpec, label = label, finishedListener = finishedListener
    )
}

è¿™ç§é‡å¤èµ‹å€¼çš„ä¹Ÿå¯ä»¥é€šè¿‡keyæ¥é¿å…é‡å¤ç”¨åˆ›å»º

---------------------

âœ… æ­£ç¡®æ€»ç»“ï¼š

* `remember` çš„ä½œç”¨æ˜¯ **é˜²æ­¢é‡ç»„æ—¶é‡æ–°åˆå§‹åŒ–**ï¼ˆå³ä¿æŒå¯¹è±¡å®ä¾‹ä¸å˜ï¼‰ã€‚
* `state` çš„ä½œç”¨æ˜¯ **åœ¨æ•°æ®å˜åŒ–æ—¶è§¦å‘é‡ç»„**ã€‚
* `remember` ä¸­çš„æ•°æ® **å¯ä»¥è¢«ä¿®æ”¹**ï¼Œåªæ˜¯ä¿®æ”¹ä¸ä¼šè§¦å‘é‡ç»„ã€‚
* `remember(key)` å¯ä»¥é€šè¿‡ **key å‚æ•°** æ¥æ§åˆ¶ä½•æ—¶é‡æ–°åˆ›å»ºï¼ˆå½“ key æ”¹å˜æ—¶é‡æ–°åˆå§‹åŒ–ï¼‰ã€‚

ä½ ä¸¾çš„ `animateColorAsState` ç¤ºä¾‹æ­£æ˜¯ç”¨ `remember(targetValue.colorSpace)` æ¥ **é¿å…é‡å¤åˆ›å»º converter** çš„å…¸å‹ç”¨æ³•ã€‚



------------------------------------------------------------------------------------------------------------------------------------------------


