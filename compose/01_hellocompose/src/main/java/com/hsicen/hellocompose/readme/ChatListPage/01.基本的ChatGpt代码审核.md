
æˆ‘å¸®ä½ çœ‹äº†ä¸€ä¸‹è¿™ä¸ª `ChatListPage` ä»£ç ï¼Œæ•´ä½“å®ç°å·²ç»å¾ˆæ¥è¿‘å¾®ä¿¡èŠå¤©åˆ—è¡¨çš„é£æ ¼äº†ï¼ŒåŠŸèƒ½å®Œæ•´ã€ç»“æ„ä¹Ÿæ¸…æ™° ğŸ‘ã€‚æˆ‘ç»™ä½ åšä¸ª **review**ï¼ŒåŒæ—¶ç»™ä¸€äº›ä¼˜åŒ–å’Œæ”¹è¿›å»ºè®®ï¼š

---

## âœ… ä¼˜ç‚¹

1. **å¸ƒå±€å±‚æ¬¡æ¸…æ™°**

   * å¤–å±‚ `Column` â†’ é¡¶éƒ¨æ  + åˆ—è¡¨ã€‚
   * `LazyColumn` æ˜¾ç¤ºèŠå¤©è®°å½•ï¼Œæ€§èƒ½å¥½ã€‚
   * `itemsIndexed` + `Divider`ï¼Œè®©åˆ†å‰²çº¿åªåœ¨éœ€è¦æ—¶ç»˜åˆ¶ã€‚

2. **ChatListItem æ‹†åˆ†**

   * èŠå¤©æ¡ç›®ç”¨ `Row` å®ç°ï¼Œå¤´åƒã€å†…å®¹ã€æ—¶é—´ä¸‰å—å¸ƒå±€æ¸…æ¥šã€‚
   * ä½¿ç”¨ `Modifier.weight(1f)` æ§åˆ¶ä¸­é—´æ¶ˆæ¯åŒºåŸŸï¼Œé¿å…ç¡¬ç¼–ç å®½åº¦ã€‚

3. **æœªè¯»å°çº¢ç‚¹**

   * è‡ªå®šä¹‰ `Modifier.unread`ï¼Œç”¨ `drawWithContent` ç»˜åˆ¶åœ¨å¤´åƒå³ä¸Šè§’ï¼Œçµæ´»ä¸”å¤ç”¨æ€§é«˜ã€‚

4. **ä¸»é¢˜åŒ–**

   * æ‰€æœ‰é¢œè‰²å–è‡ª `WeComposeTheme.colors`ï¼Œæ–¹ä¾¿åˆ‡æ¢ä¸»é¢˜ï¼ˆæš—é»‘æ¨¡å¼å‹å¥½ï¼‰ã€‚

---

## ğŸ”§ æ”¹è¿›å»ºè®®

### 1. é¿å…åœ¨ Item é‡Œç›´æ¥æ‹¿ `viewModel()`

```kotlin
val viewModel: WeViewModel = viewModel()
```

è¿™ç§å†™æ³•ä¼šè®© **æ¯ä¸ª item éƒ½å»æ‹¿ä¸€æ¬¡ ViewModel**ï¼Œè™½ç„¶è¿”å›çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œä½†ä¼šè®©äººè¯¯è§£ã€‚
æ›´æ¨èåœ¨å¤–å±‚ä¼ è¿›æ¥ï¼Œä¿æŒ **å¯ç»„åˆå‡½æ•°çš„çº¯ç²¹æ€§**ï¼š

```kotlin
@Composable
private fun ChatListItem(chat: Chat, onClick: (Chat) -> Unit) {
  Row(
    Modifier
      .clickable { onClick(chat) }
      .fillMaxWidth()
  ) {
    ...
  }
}
```

è°ƒç”¨ï¼š

```kotlin
itemsIndexed(chats) { index, chat ->
  ChatListItem(chat) { viewModel.startChat(it) }
  ...
}
```

è¿™æ · `ChatListItem` åªè´Ÿè´£ UIï¼Œä¸å’Œä¸šåŠ¡è€¦åˆã€‚

---

### 2. Divider å»ºè®®ç”¨ `ItemDecoration` æ€è·¯

ç°åœ¨çš„å†™æ³•æ˜¯ï¼š

```kotlin
if (index < chats.lastIndex) {
  Divider(...)
}
```

è¿™ä¼šè®© `Divider` å’Œ item ç´§è€¦åˆã€‚
æ›´ Compose é£æ ¼çš„å†™æ³•ï¼Œå¯ä»¥ç”¨ `LazyColumn` çš„ `items` + `items` / `itemsIndexed` + `stickyHeader` ç»„åˆï¼Œæˆ–è€…å†™ä¸ª **å¯å¤ç”¨çš„ `ItemDivider` Composable**ï¼š

```kotlin
@Composable
fun ItemDivider(startIndent: Dp = 0.dp) {
  Divider(
    startIndent = startIndent,
    color = WeComposeTheme.colors.chatListDivider,
    thickness = 0.8f.dp
  )
}
```

è¿™æ ·é€»è¾‘æ›´ç®€æ´ã€‚

---

### 3. æ–‡æœ¬æº¢å‡ºå¤„ç†

å½“å‰æ¶ˆæ¯æ–‡æœ¬ï¼š

```kotlin
Text(chat.msgs.last().text, fontSize = 14.sp, color = ...)
```

å¦‚æœæ¶ˆæ¯å¾ˆé•¿ä¼šç›´æ¥æ¢è¡Œï¼Œä¸å¤ªåƒå¾®ä¿¡ã€‚å¯ä»¥åŠ ä¸Šï¼š

```kotlin
maxLines = 1,
overflow = TextOverflow.Ellipsis
```

---

### 4. æœªè¯»å°çº¢ç‚¹ä½ç½®

ç°åœ¨çš„ `unread` æ˜¯ï¼š

```kotlin
drawCircle(color, 5.dp.toPx(), Offset(size.width - 1.dp.toPx(), 1.dp.toPx()))
```

è¿™ä¸ªå†™æ­»äº†åç§»é‡ï¼Œåœ¨ä¸åŒåˆ†è¾¨ç‡ä¸‹å¯èƒ½ä¸ç²¾ç¡®ã€‚
å¯ä»¥æ”¹æˆç›¸å¯¹å¸ƒå±€ï¼Œæ¯”å¦‚ï¼š

```kotlin
Offset(size.width - radius, radius)
```

è¿™æ ·çº¢ç‚¹åˆšå¥½è´´åœ¨å³ä¸Šè§’ã€‚

---

### 5. å¯ç‚¹å‡»åé¦ˆ

`Row(Modifier.clickable { ... })` é»˜è®¤æ²¡æœ‰æ³¢çº¹ã€‚å»ºè®®åŠ ä¸Š `indication = rememberRipple()`ï¼Œä½“éªŒæ›´è´´è¿‘åŸç”Ÿ Androidï¼š

```kotlin
Modifier.clickable(
  indication = rememberRipple(bounded = true),
  interactionSource = remember { MutableInteractionSource() }
) { onClick(chat) }
```

---

## âœ¨ æ€»ç»“

ä½ çš„ä»£ç  âœ… åŠŸèƒ½æ­£ç¡®ï¼Œâœ… UI æ•ˆæœåŸºæœ¬è¾¾æ ‡ã€‚
æˆ‘å»ºè®®ä¸»è¦ä¼˜åŒ–è¿™å‡ ç‚¹ï¼š

* æŠŠ `viewModel()` æ‹¿åˆ°å¤–å±‚ï¼Œé¿å… item ä¸ä¸šåŠ¡é€»è¾‘è€¦åˆã€‚
* Divider æŠ½å‡ºæ¥å¤ç”¨ã€‚
* æ–‡æœ¬æº¢å‡ºåŠ  `maxLines` å’Œ `ellipsis`ã€‚
* å°çº¢ç‚¹ä½ç½®ç”¨ç›¸å¯¹åæ ‡ã€‚
* ç‚¹å‡»åŠ ä¸Šæ³¢çº¹åé¦ˆã€‚

---

è¦ä¸è¦æˆ‘å¸®ä½ æ”¹å†™ä¸€ä»½ **æ›´è§£è€¦ + æ›´ Compose é£æ ¼** çš„ `ChatListItem`ï¼Œä½ å¯ä»¥ç›´æ¥æ›¿æ¢æ‰ï¼Ÿ

