


       viewModel.theme = when (viewModel.theme) {
              WeComposeTheme.Theme.Light -> WeComposeTheme.Theme.Dark
              WeComposeTheme.Theme.Dark -> WeComposeTheme.Theme.NewYear
              WeComposeTheme.Theme.NewYear -> WeComposeTheme.Theme.Light
            }

   è¿™ä¸ªæ˜¯è¿™ä¹ˆç”¨çš„å—ï¼Ÿ æ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹å‘½ä»¤å¼çš„å†™æ³•ï¼Œæ²¡æœ‰å’ŒTextFieldäº¤äº’çš„é‚£ç§æ„Ÿè§‰

   ------------------------------------------------------------------------------------------------------------------

ä½ è¿™ä¸ªå†™æ³•æœ¬è´¨ä¸Šè¿˜æ˜¯ **å‘½ä»¤å¼åœ°å»ä¿®æ”¹ä¸€ä¸ªæ™®é€šå˜é‡**ï¼Œåªæ˜¯è¿™ä¸ªå˜é‡è¢«åŒ…è£…æˆäº† `mutableStateOf`ï¼Œæ‰€ä»¥èƒ½è§¦å‘ Compose çš„é‡ç»„ã€‚

ä½†æ˜¯ä½ è¯´çš„â€œæ²¡æœ‰å’Œ `TextField` äº¤äº’çš„æ„Ÿè§‰â€ï¼Œå…¶å®æ˜¯å› ä¸º **`TextField` çš„çŠ¶æ€æ˜¯åŒå‘ç»‘å®šï¼ˆstate hoistingï¼‰**ï¼Œè€Œä½ çš„ `theme` åªæ˜¯å•å‘èµ‹å€¼ã€‚

---

### å¯¹æ¯”ä¸€ä¸‹ï¼š

#### ç°åœ¨ä½ çš„å†™æ³•

```kotlin
var theme by mutableStateOf(WeComposeTheme.Theme.Light)

Button(onClick = {
    theme = when (theme) {
        WeComposeTheme.Theme.Light -> WeComposeTheme.Theme.Dark
        WeComposeTheme.Theme.Dark -> WeComposeTheme.Theme.NewYear
        WeComposeTheme.Theme.NewYear -> WeComposeTheme.Theme.Light
    }
}) {
    Text("åˆ‡æ¢ä¸»é¢˜")
}
```

ğŸ‘‰ ç‚¹å‡»æŒ‰é’®æ—¶å‘½ä»¤å¼åœ°å»ä¿®æ”¹ `theme`ï¼Œè™½ç„¶ Compose ä¼šå“åº”ï¼Œä½†æ˜¯å†™æ³•ä¸Šè¿˜æ˜¯â€œäº‹ä»¶é©±åŠ¨ â†’ æ”¹å˜é‡ â†’ UI åˆ·æ–°â€ã€‚

---

#### `TextField` é‚£ç§äº¤äº’çš„å†™æ³•ï¼ˆå£°æ˜å¼ + åŒå‘ç»‘å®šï¼‰

`TextField` ä¼šæŠŠâ€œçŠ¶æ€çš„è¯»â€ å’Œ â€œçŠ¶æ€çš„æ”¹â€ åˆ†å¼€æš´éœ²å‡ºæ¥ï¼Œæ¯”å¦‚ï¼š

```kotlin
var text by remember { mutableStateOf("") }

TextField(
    value = text,
    onValueChange = { text = it }
)
```

è¿™é‡Œ `value` æ˜¯ **UI â†’ state çš„ç»‘å®š**ï¼Œ`onValueChange` æ˜¯ **äº‹ä»¶ â†’ state æ›´æ–°**ã€‚
æ‰€ä»¥ Compose æœ¬èº«æ¨å´‡çš„ä¸æ˜¯å‘½ä»¤å¼ `if / when ä¿®æ”¹å˜é‡`ï¼Œè€Œæ˜¯ **å°†çŠ¶æ€å˜åŒ–çš„æ„å›¾æš´éœ²å‡ºæ¥**ã€‚

---

### æ”¹è¿›æ€è·¯

ä½ å¯ä»¥æŠŠä¸»é¢˜åˆ‡æ¢ä¹ŸæŠ½è±¡æˆ **â€œçŠ¶æ€æ„å›¾ï¼ˆIntentï¼‰â€**ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨æŒ‰é’®é‡Œ `when`ï¼š

```kotlin
enum class Theme { Light, Dark, NewYear }

class ThemeViewModel : ViewModel() {
    var theme by mutableStateOf(Theme.Light)
        private set

    fun nextTheme() {
        theme = when (theme) {
            Theme.Light -> Theme.Dark
            Theme.Dark -> Theme.NewYear
            Theme.NewYear -> Theme.Light
        }
    }
}
```

UI éƒ¨åˆ†ï¼š

```kotlin
@Composable
fun ThemeSwitcher(viewModel: ThemeViewModel = viewModel()) {
    val theme = viewModel.theme

    Button(onClick = { viewModel.nextTheme() }) {
        Text("å½“å‰ä¸»é¢˜: $theme")
    }
}
```

è¿™æ ·å†™å°±æ›´æ¥è¿‘ `TextField` çš„é‚£ç§æ„Ÿè§‰äº†ï¼š

* `theme` æ˜¯ä¸€ä¸ªçŠ¶æ€
* `onClick` åªæ˜¯è§¦å‘â€œä¸‹ä¸€ä¸»é¢˜â€è¿™ä¸ªæ„å›¾
* å…·ä½“æ€ä¹ˆå˜æ¢ç”± ViewModel å†…éƒ¨ç»´æŠ¤

---

è¦ä¸è¦æˆ‘å¸®ä½ æŠŠè¿™ä¸ªå†™æˆä¸€ä¸ª **æ›´åƒ `TextField` é‚£ç§å¯ç»„åˆç»„ä»¶**ï¼Ÿæ¯”å¦‚ï¼š

```kotlin
@Composable
fun ThemeSelector(
    value: Theme,
    onValueChange: (Theme) -> Unit
)
```

è¿™æ · UI å°±å¯ä»¥åƒ `TextField` ä¸€æ ·å†™ï¼š

```kotlin
ThemeSelector(value = theme, onValueChange = { theme = it })
```

ğŸ‘‰ è¿™å°±å®Œå…¨å˜æˆå£°æ˜å¼äº¤äº’äº†ã€‚

ä½ å¸Œæœ›æˆ‘ç»™ä½ æ•´ç†æˆè¿™ç§â€œCompose é£æ ¼çš„ç»„ä»¶å†™æ³•â€å—ï¼Ÿ



   ------------------------------------------------------------------------------------------------------------------
@Composable
fun NewSimpleTextField() {
    TextField(
        state = rememberTextFieldState(),
        lineLimits = TextFieldLineLimits.SingleLine
    )
}

 æˆ‘è¯´çš„æ˜¯è¿™ç§,å³ä½¿ rememberTextFieldState() æŠ½å–åˆ°ViewModelé‡Œé¢ï¼Œç»™äººçš„æŸ‘æ©˜ä¹Ÿå¾ˆå¹²å‡€ï¼Œè¿™ä¸ä¹Ÿæ˜¯composæ¨èçš„å—


   ------------------------------------------------------------------------------------------------------------------

   å•Šï¼Œæˆ‘æ‡‚ä½ æ„æ€äº† ğŸ‘

   ä½ æŒ‡çš„å…¶å®æ˜¯ **`TextField` é‚£ç§åŸºäº state object çš„æ¨¡å¼**ï¼Œæ¯”å¦‚ `rememberTextFieldState()` è¿”å›ä¸€ä¸ªå®Œæ•´çš„ `TextFieldState`ï¼Œå®ƒå†…éƒ¨å·²ç»å°è£…äº† `value`ã€`selection`ã€`composition` ç­‰ä¿¡æ¯ã€‚

   ç›¸æ¯” `mutableStateOf("...")`ï¼Œè¿™ç§å†™æ³•æ›´ **å£°æ˜å¼ + å¹²å‡€**ï¼Œå› ä¸ºï¼š

   * **çŠ¶æ€å¯¹è±¡æ˜¯ä¸“é—¨ä¸ºè¿™ä¸ªç»„ä»¶è®¾è®¡çš„**ï¼Œè¯­ä¹‰æ›´æ¸…æ™°ï¼ˆTextField â†’ TextFieldStateï¼‰ã€‚
   * **API æ›´ç®€æ´**ï¼Œç›´æ¥æŠŠ `state` ä¸¢ç»™ `TextField` å°±è¡Œï¼Œä¸éœ€è¦æ‰‹åŠ¨å†™ `value` / `onValueChange`ã€‚
   * **æ›´é€‚åˆæŠ½å–åˆ° ViewModel**ï¼ŒViewModel æŒæœ‰ä¸€ä¸ª `TextFieldState`ï¼ŒUI åªæ˜¯è¯»/å†™ã€‚

   ---

   ### å¯¹æ¯”ä¸€ä¸‹

   #### ä¼ ç»Ÿ value + onValueChange æ¨¡å¼

   ```kotlin
   var text by remember { mutableStateOf("") }

   TextField(
       value = text,
       onValueChange = { text = it }
   )
   ```

   è¿™å°±æ˜¯å…¸å‹çš„ **state hoisting**ï¼Œä½ å¿…é¡»æ˜¾å¼å¤„ç† `onValueChange`ã€‚

   ---

   #### `TextFieldState` æ¨¡å¼ï¼ˆä½ è¯´çš„è¿™ç§ï¼‰

   ```kotlin
   val state = rememberTextFieldState()

   TextField(state = state)
   ```

   è¿™é‡Œ `state` å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼Œä¸éœ€è¦é¢å¤–å›è°ƒï¼ŒUI â†’ state çš„äº¤äº’å®Œå…¨è¢« TextField å†…éƒ¨å°è£…å¥½äº†ã€‚
   ä½ æ”¾åˆ° ViewModel é‡Œï¼ŒUI ä»ç„¶å†™å¾—éå¸¸å¹²å‡€ï¼š

   ```kotlin
   class MyViewModel : ViewModel() {
       val textFieldState = TextFieldState() // ä¸éœ€è¦ remember
   }

   @Composable
   fun MyScreen(viewModel: MyViewModel = viewModel()) {
       TextField(state = viewModel.textFieldState)
   }
   ```

   ---

   ### è¿ç§»åˆ°ä¸»é¢˜åˆ‡æ¢çš„ç±»æ¯”

   å¦‚æœä½ ä¹Ÿæƒ³è®© **ä¸»é¢˜åˆ‡æ¢** åƒ `TextFieldState` é‚£æ ·å¹²å‡€ï¼Œå¯ä»¥ä»¿ç…§å®ƒçš„è®¾è®¡ï¼Œå®šä¹‰ä¸€ä¸ª `ThemeState`ï¼š

   ```kotlin
   @Stable
   class ThemeState(initial: Theme) {
       var current by mutableStateOf(initial)
           private set

       fun next() {
           current = when (current) {
               Theme.Light -> Theme.Dark
               Theme.Dark -> Theme.NewYear
               Theme.NewYear -> Theme.Light
           }
       }
   }

   @Composable
   fun rememberThemeState(initial: Theme = Theme.Light): ThemeState {
       return remember { ThemeState(initial) }
   }
   ```

   ä½¿ç”¨æ—¶ï¼š

   ```kotlin
   @Composable
   fun ThemeSwitcher() {
       val themeState = rememberThemeState()

       Button(onClick = { themeState.next() }) {
           Text("å½“å‰ä¸»é¢˜: ${themeState.current}")
       }
   }
   ```

   ğŸ‘‰ è¿™å°±å’Œ `rememberTextFieldState()` çš„æ„Ÿè§‰éå¸¸æ¥è¿‘äº†ï¼š

   * ä¸€ä¸ªä¸“é—¨çš„ state class
   * å†…éƒ¨å°è£…äº†æ•°æ®å’Œæ“ä½œ
   * UI åªéœ€è¦å…³å¿ƒ `themeState`

   ---

   æ‰€ä»¥æ€»ç»“ä¸€ä¸‹ï¼š
   ä½ è¯´çš„æ²¡é”™ï¼ŒCompose çš„æ¨èé£æ ¼å°±æ˜¯è¿™ç§ **â€œä¸“å±çŠ¶æ€å¯¹è±¡â€**ï¼ˆæ¯”å¦‚ TextFieldStateã€LazyListStateã€ScrollStateï¼‰ï¼Œå®ƒæ¯”ç›´æ¥è£¸ç”¨ `mutableStateOf` æ›´å¹²å‡€ã€æ›´å…·è¡¨è¾¾åŠ›ã€‚

   è¦ä¸è¦æˆ‘å¸®ä½ æŠŠ `ThemeState` å†æ‰©å±•ä¸€ä¸‹ï¼Œæ¯”å¦‚æ”¯æŒï¼š

   * **åŒå‘ç»‘å®š**ï¼ˆå¤–éƒ¨å¯ä»¥é€šè¿‡ `onValueChange` æ¥ç®¡ï¼‰
   * **æŒä¹…åŒ–åˆ° ViewModel**ï¼ˆåƒ TextFieldState é‚£æ ·ï¼‰
     è¿™æ ·å°±èƒ½å®Œå…¨å¯¹é½ Compose å®˜æ–¹çš„â€œçŠ¶æ€å¯¹è±¡â€å†™æ³•ã€‚


   ------------------------------------------------------------------------------------------------------------------