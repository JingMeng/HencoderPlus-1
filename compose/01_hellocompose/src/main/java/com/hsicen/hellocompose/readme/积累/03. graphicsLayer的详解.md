

 Modifier
          .graphicsLayer(
            rotationZ = shakingAngleBubble.value,
            transformOrigin = TransformOrigin(1f, 0f)
          )
          .drawBehind {
            val bubble = Path().apply {
              val rect = RoundRect(
                10.dp.toPx(),
                0f,
                size.width - 10.dp.toPx(),
                size.height,
                4.dp.toPx(),
                4.dp.toPx()
              )
              addRoundRect(rect)
              moveTo(size.width - 10.dp.toPx(), 15.dp.toPx())
              lineTo(size.width - 5.dp.toPx(), 20.dp.toPx())
              lineTo(size.width - 10.dp.toPx(), 25.dp.toPx())
              close()
            }
            drawPath(bubble, bubbleColor)
          }
          .padding(20.dp, 10.dp)

drawBehind æˆ‘ç†è§£ä¸€ç‚¹ï¼Œä¼¼ä¹æ²¡æœ‰æœ‰drawBeforeï¼Œé‚£è¯¥æ€ä¹ˆåšï¼Œç›´æ¥boxï¼Ÿ å¦‚æœç›´æ¥boxæˆ‘ä»¬çš„drawBehind ä¸æ˜¯ä¹Ÿæ²¡æœ‰å¿…è¦

æ¯”è¾ƒä¸€ä¸‹ drawWithContent  drawBehind drawWithCache

graphicsLayer æ˜¯å¹²å˜›çš„ï¼Ÿ

è¿™ä¸ªæ˜¯å®˜æ–¹çš„æ–‡æ¡£
https://developer.android.com/develop/ui/compose/graphics/draw/modifiers?hl=zh-cn

-------------------------------------------------------------------------------------------------
å¥½é—®é¢˜ ğŸ‘ï¼Œä½ è´´çš„ä»£ç é‡Œæ¶‰åŠåˆ° **Compose ç»˜åˆ¶ä½“ç³»**çš„å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š`drawBehind`ã€`drawWithContent`ã€`drawWithCache` ä»¥åŠ `graphicsLayer`ã€‚æˆ‘å¸®ä½ æ¢³ç†ä¸€ä¸‹å®ƒä»¬çš„ä½œç”¨ã€åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯ã€‚

---

## ğŸ¨ Compose ç»˜åˆ¶ç›¸å…³ Modifier å¯¹æ¯”

### `drawBehind`

* **æ‰§è¡Œæ—¶æœº**ï¼šåœ¨ **å¸ƒå±€å†…å®¹ç»˜åˆ¶ä¹‹å‰** ç»˜åˆ¶ã€‚
* **æ•ˆæœ**ï¼šå°±åƒæ˜¯ `background`ï¼Œä½ ç”»çš„å†…å®¹åœ¨å­ Composable çš„ä¸‹å±‚ã€‚
* **åœºæ™¯**ï¼šç»˜åˆ¶èƒŒæ™¯ã€é˜´å½±ã€åº•å±‚è£…é¥°ã€‚
* **ä¾‹å­**ï¼š

  ```kotlin
  Modifier.drawBehind {
      drawRect(Color.LightGray) // èƒŒæ™¯è‰²
  }
  ```

### âŒ â€œdrawBeforeâ€

* ç¡®å®æ²¡æœ‰ `drawBefore` è¿™ä¸ª Modifierã€‚
* ä½†ä½ å¦‚æœè¦åœ¨å†…å®¹ä¹‹ä¸Šç»˜åˆ¶ï¼Œå¯ä»¥ç”¨ **`drawForeground`**ï¼ˆAPI 33 æ–°åŠ çš„ï¼‰æˆ–è€…æ›´é€šç”¨çš„ **`drawWithContent`**ã€‚

---

### `drawWithContent`

* **æ‰§è¡Œæ—¶æœº**ï¼šå…è®¸ä½ æ§åˆ¶ **å†…å®¹å’Œè‡ªå®šä¹‰ç»˜åˆ¶çš„å…ˆåé¡ºåº**ã€‚
* **å†™æ³•**ï¼šä½ å¿…é¡»æ‰‹åŠ¨è°ƒç”¨ `drawContent()` æ¥è§¦å‘åŸæœ¬çš„ Composable ç»˜åˆ¶ã€‚
* **ä¼˜åŠ¿**ï¼šæ—¢èƒ½åœ¨å†…å®¹å‰ç”»ï¼ˆä¸è°ƒç”¨ `drawContent()` ä¹‹å‰çš„éƒ¨åˆ†ï¼‰ï¼Œä¹Ÿèƒ½åœ¨å†…å®¹åç”»ï¼ˆåœ¨è°ƒç”¨ `drawContent()` ä¹‹åï¼‰ã€‚
* **ä¾‹å­**ï¼š

  ```kotlin
  Modifier.drawWithContent {
      // èƒŒæ™¯
      drawRect(Color.LightGray)
      // åŸå§‹å†…å®¹
      drawContent()
      // å‰æ™¯
      drawRect(Color.Red.copy(alpha = 0.2f))
  }
  ```

---

### `drawWithCache`

* **æ‰§è¡Œæ—¶æœº**ï¼šåœ¨ç»˜åˆ¶å‰ï¼Œå…ˆè¿›è¡Œä¸€æ¬¡æ€§è®¡ç®—ï¼ŒæŠŠå¯ç¼“å­˜çš„ Path / Shader / Gradient ç­‰å¯¹è±¡å­˜èµ·æ¥ï¼Œå‡å°‘é‡å¤åˆ›å»ºçš„å¼€é”€ã€‚
* **ä½¿ç”¨åœºæ™¯**ï¼šéœ€è¦æ€§èƒ½ä¼˜åŒ–æ—¶ï¼ˆæ¯”å¦‚é¢‘ç¹é‡ç»˜ï¼Œä½†å½¢çŠ¶æ²¡å˜ï¼‰ã€‚
* **ä¾‹å­**ï¼š

  ```kotlin
  Modifier.drawWithCache {
      val gradient = Brush.linearGradient(
          colors = listOf(Color.Magenta, Color.Cyan)
      )
      onDrawBehind {
          drawRect(gradient) // ç”¨ç¼“å­˜çš„ brush ç»˜åˆ¶
      }
  }
  ```

---

## ğŸŒ€ `graphicsLayer`

* **ä½œç”¨**ï¼šç»™ Composable æ·»åŠ ä¸€ä¸ªç‹¬ç«‹çš„ **æ¸²æŸ“å±‚ï¼ˆLayerï¼‰**ï¼Œå¹¶æ”¯æŒå„ç§å›¾å½¢å˜æ¢ã€‚
* **å¸¸è§å‚æ•°**ï¼š

  * `alpha`ï¼šé€æ˜åº¦
  * `rotationX`, `rotationY`, `rotationZ`
  * `scaleX`, `scaleY`
  * `shadowElevation`
  * `clip` / `shape`
* **ä¼˜åŠ¿**ï¼š

  * æä¾›ç¡¬ä»¶åŠ é€Ÿçš„ç»˜åˆ¶ä¼˜åŒ–ã€‚
  * èƒ½åšå¤æ‚çš„ 2D/3D å˜æ¢ã€‚
  * ç±»ä¼¼ Android View çš„ `setLayerType(HARDWARE, ...)` + `ViewPropertyAnimator`ã€‚
* **ä¾‹å­**ï¼š

  ```kotlin
  Modifier.graphicsLayer(
      rotationZ = 15f,
      scaleX = 1.2f,
      scaleY = 1.2f,
      shadowElevation = 8.dp.toPx()
  )
  ```

---

## ğŸ” å›åˆ°ä½ çš„é—®é¢˜

1. **å¦‚æœä½ è¦åœ¨å†…å®¹ä¹‹åç”»ï¼ˆç›¸å½“äºâ€œdrawBeforeâ€ï¼‰**
   â†’ ç”¨ `drawWithContent { drawContent(); â€¦ }`ã€‚
   `drawBehind` åªèƒ½ç”»åœ¨ä¸‹é¢ï¼Œä¸èƒ½æ›¿ä»£ã€‚

2. **å¦‚æœåªæ˜¯ç”»ä¸ªèƒŒæ™¯æˆ–æ°”æ³¡ï¼Œç›´æ¥ `drawBehind` å°±å¤Ÿäº†**ã€‚
   ç”¨ `Box` + `Modifier.background(...)` ä¹Ÿèƒ½å®ç°ï¼Œä½† `drawBehind` æ›´çµæ´»ï¼ˆè‡ªå®šä¹‰ Pathã€åœ†è§’å°–è§’ç­‰ï¼‰ã€‚

3. **å¦‚æœå½¢çŠ¶å¤æ‚ã€æ€§èƒ½æ•æ„Ÿ**ï¼ˆæ¯”å¦‚ Path é‡å¤åˆ›å»ºï¼‰ â†’ ç”¨ `drawWithCache`ã€‚

4. **å¦‚æœè¦æ—‹è½¬ã€ç¼©æ”¾ã€é˜´å½±ç­‰å˜æ¢** â†’ ç”¨ `graphicsLayer`ã€‚

---

è¦ä¸è¦æˆ‘ç»™ä½ å†™ä¸ª **æ°”æ³¡å¯¹æ¯” Demo**ï¼ŒæŠŠåŒä¸€ä¸ªâ€œæ°”æ³¡å¸¦å°–è§’â€çš„ç»˜åˆ¶åˆ†åˆ«ç”¨ `drawBehind` / `drawWithContent` / `drawWithCache` å®ç°ä¸€ä¸‹ï¼Œç›´è§‚çœ‹åŒºåˆ«ï¼Ÿ


-------------------------------------------------------------------------------------------------
è¿˜æ˜¯æ²¡æœ‰è¯´æ˜ç™½   drawWithContent  drawBehind drawWithCacheï¼Œä½ ä»…ä»…æ˜¯æ¯”è¾ƒäº†ä¸€ä¸‹ï¼Œæˆ‘ç›´æ¥ä¸€ä¸ªboxèµ°å¤©ä¸‹ä¸å¥½å—

å•Šæˆ‘æ‡‚ä½ çš„ç‚¹äº† ğŸ‘Œï¼Œä½ ä¸æ˜¯è¦â€œåŠŸèƒ½è¡¨æ ¼å¯¹æ¯”â€ï¼Œè€Œæ˜¯æƒ³ææ¸…æ¥šï¼š

ğŸ‘‰ **æ—¢ç„¶æˆ‘èƒ½ç”¨ Boxï¼ˆèƒŒæ™¯ + å‰æ™¯å åŠ ï¼‰å®ç°ä¸€åˆ‡ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨è¿™äº› drawXXX ç³»åˆ—ï¼Ÿ**

æˆ‘æ¢ä¸ªè§’åº¦è¯´ï¼ŒæŠŠæ ¸å¿ƒåŒºåˆ«è®²æ¸…æ¥šï¼š

---

## 1. Box æ–¹æ¡ˆï¼šç»„åˆå¼

```kotlin
Box(
  modifier = Modifier
      .background(Color.Gray) // èƒŒæ™¯
      .padding(8.dp)
) {
  Text("å†…å®¹") // å†…å®¹
  Icon(...)   // å‰æ™¯
}
```

* **ä¼˜ç‚¹**

  * æ€ç»´ç›´è§‚ï¼ˆå…ˆå†™èƒŒæ™¯ï¼Œå†æ”¾å†…å®¹ï¼Œå†æ”¾å‰æ™¯ï¼‰ã€‚
  * é‡ç”¨ç°æˆçš„ Modifierï¼ˆbackgroundã€borderã€clip ç­‰ï¼‰ã€‚
* **ç¼ºç‚¹**

  * é¢å¤–å¤šäº†ä¸€å±‚ Composableï¼ˆå¯èƒ½æ˜¯å‡ åã€å‡ ç™¾ä¸ª item çš„åˆ—è¡¨æ—¶ï¼Œè¿™ç§é¢å¤–å±‚çº§ä¼šç´¯ç§¯ï¼‰ã€‚
  * æŸäº›ç‰¹æ®Šæ•ˆæœä¸å¥½å®ç°ï¼ˆæ¯”å¦‚ Path è£å‰ªã€å¤æ‚æ¸å˜ã€å¸¦åœ†è§’å°–è§’çš„æ°”æ³¡ï¼‰ã€‚

---

## 2. drawBehindï¼šåªç®¡â€œèƒŒæ™¯â€

```kotlin
Modifier.drawBehind {
    drawRect(Color.Gray) // åœ¨å†…å®¹ä¹‹å‰ç”»
}
```

* **ç­‰ä»·äº Box+background**ï¼Œä½†æ˜¯ï¼š

  * æ²¡æœ‰é¢å¤– Box è¿™ä¸€å±‚ï¼Œæ€§èƒ½å’Œå±‚çº§æ›´è½»ã€‚
  * å¯ä»¥è‡ªç”±ç”» Pathã€Gradientã€é˜´å½±ï¼Œæ¯” background çµæ´»ã€‚

ğŸ‘‰ å¦‚æœåªæ˜¯â€œèƒŒæ™¯â€ â†’ `drawBehind` æ¯”é¢å¤–åŠ ä¸€ä¸ª Box æ›´å¹²å‡€ã€‚

---

## 3. drawWithContentï¼šå‰åéƒ½èƒ½æ’æ‰‹

```kotlin
Modifier.drawWithContent {
    drawRect(Color.Gray) // åœ¨å†…å®¹å‰
    drawContent()        // å†…å®¹
    drawRect(Color.Red)  // åœ¨å†…å®¹å
}
```

* ä½ è‡ªå·±å†³å®šï¼š

  * åœ¨å†…å®¹å‰ç”» â†’ ç­‰ä»·äº `drawBehind`ã€‚
  * åœ¨å†…å®¹åç”» â†’ ç­‰ä»·äºâ€œå‰æ™¯å±‚â€ã€‚
* æ‰€ä»¥å®ƒ = â€œå…¨èƒ½ç‰ˆâ€ï¼Œä½ æ§åˆ¶æ•´ä¸ªç»˜åˆ¶é¡ºåºã€‚

ğŸ‘‰ å¦‚æœéœ€è¦**å‰æ™¯+èƒŒæ™¯+å†…å®¹æ··åˆæ§åˆ¶**ï¼Œ`drawWithContent` æ— å¯æ›¿ä»£ã€‚
ğŸ‘‰ å¦‚æœåªæ˜¯èƒŒæ™¯ï¼Œé‚£ç¡®å® **Box å°±å¤Ÿäº†**ã€‚

---

## 4. drawWithCacheï¼šæ€§èƒ½ä¼˜åŒ–ç‰ˆ

```kotlin
Modifier.drawWithCache {
    val bubble = Path().apply { ... } // åªç®—ä¸€æ¬¡
    onDrawBehind {
        drawPath(bubble, Color.Gray)
    }
}
```

* **é—®é¢˜**ï¼š`drawBehind` å’Œ `drawWithContent` æ¯ä¸€å¸§éƒ½ä¼šæ–°å»ºå¯¹è±¡ï¼ˆPathã€Shaderï¼‰ï¼ŒGC å‹åŠ›å¤§ã€‚
* **è§£å†³**ï¼š`drawWithCache` å¯ä»¥ç¼“å­˜è¿™äº›å¯¹è±¡ï¼Œåªåœ¨å¤§å°/çŠ¶æ€å˜åŒ–æ—¶é‡æ–°åˆ›å»ºã€‚
  ç‰¹åˆ«é€‚åˆå¤æ‚å›¾å½¢ï¼ˆåœ†è§’æ°”æ³¡ã€æ¸å˜åˆ·å­ã€Pathï¼‰ã€‚

ğŸ‘‰ å¦‚æœä½ ç”»çš„å›¾å½¢**å¤æ‚ä½†ä¸å¸¸å˜**ï¼Œç”¨ `drawWithCache` æ€§èƒ½æ›´å¥½ã€‚

---

## 5. graphicsLayerï¼šç‹¬ç«‹æ¸²æŸ“å±‚ + ç¡¬ä»¶åŠ é€Ÿ

```kotlin
Modifier.graphicsLayer(
    rotationZ = 15f,
    shadowElevation = 8.dp.toPx()
)
```

* è·Ÿç»˜åˆ¶é€»è¾‘æ²¡å…³ç³»ï¼Œè€Œæ˜¯ç»™å½“å‰ Composable åˆ›å»ºä¸€ä¸ª**æ–°çš„å›¾å±‚**ã€‚
* æ‰€æœ‰æ—‹è½¬ã€ç¼©æ”¾ã€é˜´å½±ã€è£å‰ªï¼Œéƒ½åœ¨è¿™ä¸ªç‹¬ç«‹å›¾å±‚ä¸Šåšã€‚
* ç±»ä¼¼ View çš„ `setLayerType(HARDWARE, null)` + `ViewPropertyAnimator`ã€‚

---

## ğŸ§­ æ€»ç»“ä¸€å¥è¯

* **Box èµ°å¤©ä¸‹** â†’ å¯ä»¥ï¼Œä½†å±‚çº§ä¼šå¤šï¼Œå¯¹æ€§èƒ½æœ‰ç‚¹æŸè€—ã€‚
* **drawBehind** â†’ æœ€è½»é‡çš„â€œèƒŒæ™¯å±‚â€ï¼Œæ›¿ä»£å¤šä½™çš„ Boxã€‚
* **drawWithContent** â†’ å¦‚æœä½ è¦åœ¨å†…å®¹å‰åéƒ½ç”»ï¼Œé‚£åªèƒ½å®ƒã€‚
* **drawWithCache** â†’ åœ¨ `drawBehind` / `drawWithContent` åŸºç¡€ä¸Šåšç¼“å­˜ä¼˜åŒ–ã€‚
* **graphicsLayer** â†’ å›¾å±‚å’Œç¡¬ä»¶åŠ é€Ÿï¼Œä¸ç”»ä¸œè¥¿ï¼Œåªè´Ÿè´£å˜æ¢/æ¸²æŸ“ç‰¹æ•ˆã€‚

---

ğŸ‘‰ è¿™æ ·è¯´å¯èƒ½æ›´ç›´ç™½ï¼š

* **èƒ½ç”¨ Box æå®šï¼Œä½†ä¸å¤Ÿä¼˜é›…**ï¼›
* **drawXXX ç³»åˆ—æ˜¯â€œè½»é‡ç‰ˆ Boxâ€**ï¼Œä¸“é—¨ä¸ºâ€œèƒŒæ™¯/å‰æ™¯è£…é¥°â€è®¾è®¡çš„ï¼›
* **drawWithCache** = â€œdraw ç³»åˆ—çš„æ€§èƒ½ä¼˜åŒ–â€ï¼›
* **graphicsLayer** = â€œåŠ é€Ÿå™¨ + å˜å½¢å™¨â€ã€‚

---

è¦ä¸è¦æˆ‘ç»™ä½ å†™ä¸ª Demoï¼š**åŒæ ·çš„æ°”æ³¡å¸¦å°–è§’**ï¼Œåˆ†åˆ«ç”¨ Boxã€drawBehindã€drawWithContentã€drawWithCache å®ç°ï¼Œä½ å°±èƒ½ä¸€çœ¼çœ‹å‡ºä»£ç å±‚çº§å’Œæ€§èƒ½å·®åˆ«ï¼Ÿ


-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------